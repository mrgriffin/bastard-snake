<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bastard Snake</title>
<script src="js/canvas-renderer.js"></script>
<script src="js/direction.js"></script>
<script src="js/entity.js"></script>
<script src="js/food.js"></script>
<script src="js/game.js"></script>
<script src="js/keyboard-controller.js"></script>
<script src="js/portal.js"></script>
<script src="js/room.js"></script>
<script src="js/snake.js"></script>
<script src="js/touch-controller.js"></script>
<script src="js/wall.js"></script>
<script>
(function (window, document) {
document.addEventListener('DOMContentLoaded', function (e) {
	var container = document.createElement('div');
	container.style.display = 'block';
	document.body.appendChild(container);
	document.body.appendChild(document.createTextNode("Tap or press a key to (re-)start."));

	var renderer = new CanvasRenderer(container);
	var FPS = 3;
	var gameover = true;

	// TODO: Draw a demo instead.
	new Game().drawOn(renderer);

	window.addEventListener('mouseup', function () { if (gameover) newGame(); });
	// TODO: Do not trigger if the user presses a modifier key.
	window.addEventListener('keydown', function () { if (gameover) newGame(); });

	var newGame = function () {
		var game = new Game();
		// TODO: Not violate the Law of Demeter when constructing these controllers.
		var kbc = new KeyboardController(game.snake);
		var tc = new TouchController(game.snake, container);
		game.drawOn(renderer);
		gameover = false;
		var updateInterval = window.setInterval(function () {
			if (game.update()) {
				game.drawOn(renderer);
			} else {
				window.clearInterval(updateInterval);
				gameover = true;
				kbc.remove();
				tc.remove();
			}
		}, Math.floor(1000 / FPS));
	};
});
}(window, document));
</script>
</head>
<body>
</body>
</html>
